SharedPreferences = {}
SharedPreferences.__index = SharedPreferences

setmetatable(SharedPreferences, {
  __call = function (cls, programInstance)
    return cls.new(programInstance)
  end,
})

function SharedPreferences.new(programInstance)
  local self = setmetatable({}, SharedPreferences)
  self.programInst = programInstance
  self:read()
  return self
end

function SharedPreferences:createFileIfNotExists()
  if not fs.exists(self:getFilePath()) then
    local file = fs.open(self:getFilePath(), "w")
    file.close()
  end
end

function SharedPreferences:getFilePath()
  return self.programInst.ProgramPath.."/preferences.txt"
end

function SharedPreferences:read()
  self:createFileIfNotExists()

  local file = fs.open(self:getFilePath(), "r")
  self.values = textutils.unserialize(file.readAll())
  file.close()
end

function SharedPreferences:edit(key, value)
  self:createFileIfNotExists()

  local file = fs.open(self:getFilePath(), "r")
  local tbl = textutils.unserialize(file.readAll())
  if tbl == nil then tbl = {} end
  tbl[key] = value
  file.close()
    
  file = fs.open(self:getFilePath(), "w")
  file.write(textutils.serialize(tbl))
  file.close()
end