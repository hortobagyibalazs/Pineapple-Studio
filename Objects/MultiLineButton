Inherit = "Button"
Wrap = true

local wrapText = function(text, maxWidth)
  local elements = {}
  local pattern = '([^/]+)'
  string.gsub(text, pattern, function(value) elements[#elements + 1] = value  end)
  
  local visibleSlashes = #elements - 1
  if visibleSlashes > 0 then
    for i = 1, visibleSlashes do
      table.insert(elements, 2 * i, "/")
    end
  end
  
  local lines = {}
  local num = 1
  for k, v in pairs(elements) do
    if lines[num] == nil then
      lines[num] = ""
    end
    
    if #lines[num] + #v > maxWidth then
      num = num + 1
      lines[num] = v
    else
      lines[num] = lines[num]..v
    end
  end
  
  return lines
end

OnDraw = function(self, x, y)
	local bg = self.BackgroundColour

	if self.Toggle then
		bg = self.ActiveBackgroundColour
	end

	local txt = self.TextColour
	if self.Toggle then
		txt = self.ActiveTextColour
	end
	if not self.Enabled then
		txt = self.DisabledTextColour
	end
	Drawing.DrawBlankArea(x, y, self.Width, self.Height, bg)

  local lines
  if self.Wrap then
    lines = wrapText(self.Text, self.Width)
  else
    lines = {self.Bedrock.Helpers.TruncateString(self.Text, self.Width)}
  end

	for i, v in ipairs(lines) do
    local _x = 0
    if self.Align == 'Right' then
      _x = self.Width - #v
    elseif self.Align == 'Center' then
      _x = math.floor((self.Width - #v) / 2)
    end
		Drawing.DrawCharacters(x + _x, y + i - 1, v, txt, bg)
	end
end